// ecoAtom UI simulation script // ----------- DOM references ----------- const rpmSpan = document.getElementById("rpm-value"); const omegaSpan = document.getElementById("omega-value"); const centrifugalSpan = document.getElementById("centrifugal-value"); const pressureSpan = document.getElementById("pressure-value"); const basePressureSpan = document.getElementById("base-pressure-value"); const vacuumLevelDiv = document.getElementById("vacuum-level"); const coreStabilityBar = document.getElementById("core-stability-bar"); const beamIntegrityBar = document.getElementById("beam-integrity-bar"); const startBtn = document.getElementById("start-demo"); const stopBtn = document.getElementById("stop-demo"); const emergencyBtn = document.getElementById("emergency-stop"); const beamIntensitySlider = document.getElementById("beam-intensity"); const simSpeedSlider = document.getElementById("sim-speed"); const toggleAtomsCheckbox = document.getElementById("toggle-atoms"); const toggleEventsCheckbox = document.getElementById("toggle-events"); const eventList = document.getElementById("event-list"); const logOutput = document.getElementById("log-output"); const facilityStatusLight = document.getElementById("facility-status-light"); const facilityStatusText = document.getElementById("facility-status-text"); const runIdSpan = document.getElementById("run-id"); const runModeSpan = document.getElementById("run-mode"); const uptimeSpan = document.getElementById("uptime-display"); const eventCountSpan = document.getElementById("event-count-display"); const ringBeam = document.getElementById("ring-beam"); const atomField = document.getElementById("atom-field"); // ----------- Simulation state ----------- const initialPressure = 1e-3; const basePressure = 1e-9; basePressureSpan.textContent = basePressure.toExponential(1); let state = { running: false, emergencyLock: false, rpm: 0, omega: 0, centrifugal: 0, pressure: initialPressure, time: 0, runId: null, events: 0, lastEventTime: 0 }; let lastFrameTime = performance.now(); // ----------- Utility helpers ----------- function logLine(tag, message) { const line = document.createElement("div"); line.className = "log-line"; const time = new Date().toISOString().split("T")[1].replace("Z", ""); line.innerHTML = `<span class="log-tag">[${tag}]</span> ${time} — ${message}`; logOutput.prepend(line); // keep last ~50 lines while (logOutput.children.length > 50) { logOutput.removeChild(logOutput.lastChild); } } function setStatus(status) { facilityStatusLight.classList.remove("status-ok", "status-warning", "status-danger"); if (status === "ok") { facilityStatusLight.classList.add("status-ok"); facilityStatusText.textContent = "Nominal"; } else if (status === "warn") { facilityStatusLight.classList.add("status-warning"); facilityStatusText.textContent = "Attention"; } else if (status === "danger") { facilityStatusLight.classList.add("status-danger"); facilityStatusText.textContent = "Emergency"; } } function formatSeconds(t) { return t.toFixed(1) + " s"; } function getSimSpeedFactor() { const val = Number(simSpeedSlider.value || 3); // 1-5 → 0.5x .. 2.5x return 0.5 + (val - 1) * 0.5; } // ----------- Atoms background ----------- let atomsSpawned = false; function spawnAtoms(count = 70) { if (atomsSpawned) return; atomsSpawned = true; const colors = ["#4de2ff", "#ff4b6b", "#ffcc4d", "#39ffb6", "#b76bff"]; for (let i = 0; i < count; i++) { const atom = document.createElement("div"); atom.className = "atom"; atom.style.left = Math.random() * 100 + "%"; atom.style.top = (20 + Math.random() * 60) + "%"; atom.style.background = colors[Math.floor(Math.random() * colors.length)]; atom.style.animationDuration = (4 + Math.random() * 6) + "s"; atom.style.animationDelay = (Math.random() * 4) + "s"; atomField.appendChild(atom); } } function clearAtoms() { atomField.innerHTML = ""; atomsSpawned = false; } // initial spawn spawnAtoms(); toggleAtomsCheckbox.addEventListener("change", () => { if (toggleAtomsCheckbox.checked) { spawnAtoms(); } else { clearAtoms(); } }); // ----------- Event system ----------- function addEvent() { state.events += 1; eventCountSpan.textContent = String(state.events); const li = document.createElement("li"); li.className = "event-item event-pulse"; const main = document.createElement("span"); main.className = "event-main"; main.textContent = `Event #${state.events}`; const meta = document.createElement("span"); meta.className = "event-meta"; meta.textContent = `RPM=${state.rpm.toFixed(0)}, P=${state.pressure.toExponential(2)} Pa`; li.appendChild(main); li.appendChild(meta); eventList.prepend(li); // Limit events list while (eventList.children.length > 16) { eventList.removeChild(eventList.lastChild); } setTimeout(() => { li.classList.remove("event-pulse"); }, 500); } // ----------- Control actions ----------- function startRun() { if (state.emergencyLock) { logLine("WARN", "Cannot start — emergency lock is active."); return; } if (state.running) return; state.running = true; runModeSpan.textContent = "Run"; if (!state.runId) { state.runId = "RUN-" + Math.floor(Math.random() * 999999).toString().padStart(6, "0"); runIdSpan.textContent = state.runId; } setStatus("ok"); logLine("INFO", "Run started."); } function stopRun() { if (!state.running) return; state.running = false; runModeSpan.textContent = "Idle"; logLine("INFO", "Run stopped."); } function emergencyStop() { state.running = false; state.emergencyLock = true; setStatus("danger"); runModeSpan.textContent = "Emergency"; state.rpm = 0; state.omega = 0; state.centrifugal = 0; state.pressure = initialPressure; state.time = 0; updateUI(true); logLine("ALERT", "Emergency stop activated. Systems halted."); alert("⚠ EMERGENCY STOP ACTIVATED — All systems halted.\nManual reset required."); // After a delay, allow reset setTimeout(() => { state.emergencyLock = false; setStatus("warn"); logLine("WARN", "Emergency lock released. System in attention mode."); }, 5000); } // ----------- Button wiring ----------- startBtn.addEventListener("click", startRun); stopBtn.addEventListener("click", stopRun); emergencyBtn.addEventListener("click", emergencyStop); // ----------- Physics-ish updates ----------- function stepPhysics(dt) { const speedFactor = getSimSpeedFactor(); const scaledDt = dt * speedFactor; state.time += scaledDt; if (state.running) { // RPM: accelerate toward 20000 with smoothing const targetRpm = 20000 * (0.3 + 0.7 * (beamIntensitySlider.value / 100)); const rampRate = 4000; // rpm per simulated second const diff = targetRpm - state.rpm; const step = Math.sign(diff) * Math.min(Math.abs(diff), rampRate * scaledDt); state.rpm += step; // Basic stability estimation const stability = Math.max(0, 1 - Math.abs(state.rpm - 16000) / 16000); coreStabilityBar.style.width = (stability * 100).toFixed(1) + "%"; // Beam integrity based on beam intensity const intensity = beamIntensitySlider.value / 100; const integrity = 0.6 + 0.4 * (1 - Math.abs(intensity - 0.7)); beamIntegrityBar.style.width = (integrity * 100).toFixed(1) + "%"; // Emergency hint if RPM very high if (state.rpm > 18000) { setStatus("warn"); } // Angular velocity and centrifugal acceleration state.omega = (state.rpm / 60) * 2 * Math.PI; const radius = 10; // meters, arbitrary state.centrifugal = state.omega * state.omega * radius; // Vacuum: exponential approach to base pressure const pumpFactor = 0.6; const outgassing = 0.01; const diffP = state.pressure - basePressure; const pumpTerm = -pumpFactor * diffP; const outgasTerm = outgassing * state.pressure; state.pressure += (pumpTerm + outgasTerm) * scaledDt; if (state.pressure < basePressure) { state.pressure = basePressure; } // Events if (toggleEventsCheckbox.checked) { const minInterval = 0.3; const maxInterval = 4.0; const normalized = Math.min(1, state.rpm / 20000); const targetInterval = maxInterval - normalized * (maxInterval - minInterval); if (state.time - state.lastEventTime >= targetInterval) { addEvent(); state.lastEventTime = state.time; } } // Beam visualization: rotate based on RPM and elapsed time const beamAngle = (state.time * state.rpm * 0.3) % 360; ringBeam.style.transform = `rotate(${beamAngle}deg)`; } else { // When not running, gently slow RPM and relax bars state.rpm *= Math.pow(0.5, scaledDt); // exponential decay if (state.rpm < 1) state.rpm = 0; state.omega = (state.rpm / 60) * 2 * Math.PI; const radius = 10; state.centrifugal = state.omega * state.omega * radius; const currentWidth = parseFloat(coreStabilityBar.style.width || "0"); const newWidth = currentWidth * Math.pow(0.5, scaledDt); coreStabilityBar.style.width = newWidth.toFixed(1) + "%"; const currentWidthBeam = parseFloat(beamIntegrityBar.style.width || "0"); const newWidthBeam = currentWidthBeam * Math.pow(0.5, scaledDt); beamIntegrityBar.style.width = newWidthBeam.toFixed(1) + "%"; // Beam angle stabilizes const beamAngle = (state.time * 50) % 360; ringBeam.style.transform = `rotate(${beamAngle}deg)`; } // Vacuum visual reaction const frac = Math.max(0, Math.min(1, 1 - Math.log10(state.pressure + 1e-12) / 12)); vacuumLevelDiv.style.width = (frac * 100).toFixed(1) + "%"; if (frac < 0.3) { vacuumLevelDiv.style.background = "linear-gradient(90deg, #ff4b6b, #ffcc4d)"; } else if (frac < 0.7) { vacuumLevelDiv.style.background = "linear-gradient(90deg, #ffcc4d, #39ffb6)"; } else { vacuumLevelDiv.style.background = "linear-gradient(90deg, #39ffb6, #4de2ff)"; } const vacuumNote = document.getElementById("vacuum-status-note"); if (state.pressure <= basePressure * 1.1) { vacuumNote.textContent = "Base pressure achieved — chamber ready."; } else if (state.pressure < 1e-6) { vacuumNote.textContent = "Ultra-high vacuum established — stabilizing..."; } else if (state.pressure < 1e-3) { vacuumNote.textContent = "Pumps active — approaching operational vacuum."; } else { vacuumNote.textContent = "Bringing pumps online..."; } } // ----------- UI update ----------- function updateUI(fromEmergencyReset = false) { rpmSpan.textContent = state.rpm.toFixed(0); omegaSpan.textContent = state.omega.toFixed(1); centrifugalSpan.textContent = state.centrifugal.toFixed(1); pressureSpan.textContent = state.pressure.toExponential(3); uptimeSpan.textContent = formatSeconds(state.time); if (fromEmergencyReset) { coreStabilityBar.style.width = "0%"; beamIntegrityBar.style.width = "0%"; vacuumLevelDiv.style.width = "10%"; } } // ----------- Main loop ----------- function frame(now) { const dtSeconds = (now - lastFrameTime) / 1000; lastFrameTime = now; stepPhysics(dtSeconds); updateUI(false); requestAnimationFrame(frame); } // Start animation loop requestAnimationFrame(frame); // Initial log logLine("INFO", "ecoAtom UI initialized in client-side simulation mode."); logLine("INFO", "Use Start Run / Stop Run / Emergency Stop to control the demo.");